!function(t,e,n){"use strict";function r(e,n){return"function"==typeof e.indexOf&&!!~e.indexOf(n)||t.got(e,n)}function i(t){return(t+"").replace(D,H)}function s(t){return ue[t]||null}function u(t){return"object"==typeof t&&(t.constructor===Object||t.constructor===R)}function o(e,n,r){n||(n=t),r||(r=e);for(var i,s=-1,u=e.length,o=[];u>++s;)switch(i=n.call(r,e[s],s,e)){case null:case R:break;default:switch(typeof i){case"string":""===i.trim()||o.push(i);break;case"number":isNaN(i)||o.push(i);break;default:!t.iter(i)||t.len(i)||o.push(i)}}return o}function a(e){return!t.empty(e)}function c(e,n){switch(this[F]=[],this.push(t.global),n!==R&&(this.hasFallback=!0,this.fallback=n),t.ntype(e)){case"object":this.push(e);break;case"array":e[M.dict]?e.map(this.push,this):this.push(e);break;default:!t.exists(e)||this.push(e)}}function f(e,n,r,i){var s=Object.keys(e=this._=Object(e)),u=s.length;return u?("[object Object]"==t.tostr(e)||(s=s.map(Number)),this.empty=!1,this.count=isNaN(i)?u:0>i?u+i:i>u?u:i,0==r||isNaN(r)?(this.firstIndex=0,this.index=-1):(this.firstIndex=r,this.index=r-2),this.index1=this.index+1,this.lastIndex=this.count===u?this.count-1:this.count,this.keys=s,!(n instanceof f)||(this.parent=n),void 0):this.stop()}function h(e,n){return t.empty(n)||e.push(n),e}function l(e,n){return n.reduce(function(n,r,i){if(0==i)return k(e,r);var s,u="",o=r.indexOf(":");return~o?(s=r.substring(0,o),u=r.substring(o+1)):s=r,!u||(u=", "+u.split(",").map(function(t){return k(this,t)},e).join(", ")),t.format(ae,b(s),s,k(e,n),u,M.ctx)},"")}function p(t,e){for(var n,r=[z];n=e.shift();)r.push(y(t,n,e));return r.push(X),r.join("\r\n")}function d(t){return t.replace(Q,"").replace(Y,"\n").replace(Z," ").trim()}function m(n,r){n.debug&&t.global[B]!==void 0&&(t.global[B].info(e+": ",n.id,", source: "),t.global[B].log(r)),r+=t.format("\n//@ sourceURL={0}",n.sourceURL?n.sourceURL:t.format("/Templ8/{0}.tpl",n.id));var i=Function("root","ContextStack","Iter",M.filter,M.assert,M.util,M.ctx,r).bind(n,t.global,c,f,t.copy(n.filters,E.Filter.all(),!0),K,A);return t.def(i,"src",t.describe(r,"r")),i}function g(t){t.currentIterKeys=[];var e=m(t,p(t,x(t.__tpl__)));return delete t.currentIterKeys,e}function y(e,n,r){var i;return(i=E.Tag.get(n))?(n=r.shift(),i.emit(S,e,n,r)):I(t.format('"{0}"',n.replace(J,"\\$1")))}function _(t,e){switch(e=d(e)){case"AND":return" && ";case"OR":return" || "}return r(e,"|")||r(e,q)?(" "+e+q).replace(re,function(e){return K.blank(e)||e==q?"":l(t,d(e).split("|"))}):k(t,e)}function b(t){return K[t]?M.assert:A[t]?M.util:M.filter}function x(t){return t.replace(N,se).split(ie).reduce(h,[])}function v(e,n){switch(typeof e){case"boolean":case"number":case"string":return e+"";default:switch(t.ntype(e)){case"date":return e.toDateString();case"array":return o(e,v).join(", ");case"object":return W in e?v(e.dict):"[object Object]"!=(n=""+e)?n:o(Object.values(e),v).join(", ");default:switch(t.type(e)){case"htmlelement":return e.outerHTML;case"htmlcollection":return o(Array.coerce(e),function(t){return v(t)}).join("\n")}}}return""}function w(t){return this==t||K.startsWith(this,t+".")}function j(t,e){return t.length?t.some(function(t){return t.some(w,e)}):0}function k(e,n){var i=e.currentIterKeys||[];return n=d(n),r(n,".call(")||te.test(n)||K.startsWith(n,'"')&&K.endsWith(n,'"')||K.startsWith(n,"'")&&K.endsWith(n,"'")||!isNaN(n)?n:K.startsWith(n,"$_.")||K.startsWith(n,"iter.")||i.length&&j(i,n)||n in C?n.replace(ee,ne):t.format('$C.get( "{0}" )',n)}function I(e){return t.format("{0} += {1};",M.output,e.replace(G,"\\n"))}function E(){var t=Array.coerce(arguments),e=u(t[t.length-1])?t.pop():u(t[0])?t.shift():null;return this instanceof E?(!e||P.forEach(function(t){t in e&&(this[t]=e[t],delete e[t])},this),this.filters=e||{},this.__tpl__=t.join(""),ue[T(this)]=this,this.compiled&&(this.compiled=!1,O(this)),void 0):u(e)?new E(t.join(""),e):new E(t.join(""))}function T(e){return e.id||(e.id=t.format(oe,++V)),e.id}function O(t){return t.compiled||(t.compiled=!0,t._parse=g(t)),t}function $(t){this.compiled||O(this),this[M.dict]=t;var e=this._parse(t);return delete this[M.dict],e}function L(e){function n(t,e,n){!n&&t in i||(i[t]=e)}function r(t,e){switch(typeof e){case"string":n(e,arguments[2],t);break;case"object":for(var r in e)n(r,e[r],t)}return this}var i={};!u(e)||t.copy(i,e),this.all=function(){return t.copy(i)},this.add=function(){return r.call(this,!1,arguments[0],arguments[1])},this.get=function(t){return i[t]},this.replace=function(){return r.call(this,!0,arguments[0],arguments[1])}}var R,S,N,C="__ASSERT__ __CONTEXT__ __FILTER_ __OUTPUT__ __UTIL__ $_ document false global instanceof null true typeof undefined window".split(" ").reduce(function(t,e){return t[e]=!0,t},t.obj()),K={blank:function(e){return t.empty(e)||"string"==typeof e&&!e.trim()},contains:r,endsWith:function(t,e){t+="";var n=t.length-e.length;return n>=0&&t.lastIndexOf(e)==n},empty:t.empty,equals:function(t,e){return t==e},exists:t.exists,is:function(t,e){return t===e},isEven:function(t){return!(1&parseInt(t,10))},isOdd:function(t){return!!(1&parseInt(t,10))},isTPL:function(e){return!(!s(t.format(ce,this.id,e))&&!s(e))},iterable:function(e){return t.iter(e)},notEmpty:a,startsWith:function(t,e){return 0===(t+"").indexOf(e)}},U={},A={inspect:function(e){switch(t.ntype(e)){case"object":case"array":console.dir(e);break;default:console.log(e)}return""},objectify:function(t,e){var n={};return n[e]=t,n},parse:function(e,n){var r,i;return n instanceof E?i=n:(n=(n+"").trim(),i=s(t.format(ce,this.id,n))||s(n)),i?(e[M.parent]=this[M.dict],r=i.parse(e),delete e[M.parent],r):this.fallback},stop:function(t){t.stop()},stringify:v,type:function(e,n){var r=t.type(e);return"string"==typeof n?r==n:r},value:function(t,e){return Object.value(t,e)}},W="__tpl_cs_cached_keys",F="__tpl_cs_stack",P="compiled debug dict fallback id sourceURL".split(" "),q="<~>",D=/([-\*\+\?\.\|\^\$\/\\\(\)[\]\{\}])/g,H="\\$1",M={assert:"__ASSERT__",ctx:"__CONTEXT__",dict:"__dict__",filter:"__FILTER__",output:"__OUTPUT__",parent:"__PARENT__",util:"__UTIL__"},X=t.format("return {0};\n ",M.output),z='\n"use strict";\n'+t.format('var $C = new ContextStack( {0}, this.fallback, this.dict ), $_ = $C.current(), iter = new Iter( null ), {1} = "", U;',M.ctx,M.output),V=999,B="console",G=/[\n\r]/gm,J=/(['"])/g,Q=RegExp(q,"gm"),Y=/[\r\n]+/g,Z=/\s+/g,te=/[\(\)\[\]\{\}\?\*\+\/<>%&=!-]/,ee=/\.(\d+)(\.?)/g,ne="['$1']$2",re=RegExp("\\s*([^\\|]+(?:\\|[^\\|]+?)){0,}"+q,"g"),ie="<__SPLIT__TEMPLATE__HERE__>",se=["","$1","$2",""].join(ie),ue={},oe="t8-anon-{0}",ae='{0}["{1}"].call( this, {2}{3}, {4} )',ce="{0}.{1}";c.prototype={current:function(){return(this.top||this[F][0]).dict},get:function(t){for(var e,n,r=this[F],i=r.length;i--;){if(e=r[i],t in e.cache)return e.cache[t];if((n=e.dict[t])!==R||(n=Object.value(e.dict,t))!==R)return e.cache[t]=n}return this.hasFallback?this.fallback:R},pop:function(){var t=this[F].pop().dict;return this.top=this[F][this[F].length-1],t},push:function(e){return this[F].push(this.top={cache:t.obj(),dict:e}),this}},f.prototype={empty:!0,hasNext:function(){return this.stopped||this.empty?!1:(++this.index<this.lastIndex||(this.stop().isLast=!0),this.key=this.keys[this.index1++],this.current=this.val=this._[this.key],this)},stop:function(){return this.stopped=!0,this}},t.defs(f.prototype,{first:{get:function(){return this._[this.keys[this.firstKey]]}},last:{get:function(){return this._[this.keys[this.lastKey]]}},next:{get:function(){return this._[this.keys[this.nextKey]]}},prev:{get:function(){return this._[this.keys[this.prevKey]]}},nextIndex:{get:function(){var t=this.index+1;return this.lastIndex>=t?t:R}},prevIndex:{get:function(){var t=this.index-1;return t>=this.firstIndex?t:R}},firstKey:{get:function(){return this.keys[this.firstIndex]}},lastKey:{get:function(){return this.keys[this.lastIndex]}},nextKey:{get:function(){return this.keys[this.nextIndex]}},prevKey:{get:function(){return this.keys[this.prevIndex]}}},"r"),S={assembleparts:p,clean:d,compiletpl:m,createtpl:g,emittag:y,fnvar:M,formatstatement:_,get:k,util:A,wrap:I},E.prototype={compiled:!1,debug:!1,dict:null,fallback:"",parse:$},t.defs(E,{m8:{value:t},escapeRE:i,format:t.format,get:s,gsub:t.gsub,stringify:v},"r"),E.Assert=new L(K),E.Filter=new L(U),E.Statement=new L,E.Tag=new function(){function n(e){s.forEach(r,e),t.copy(this,e),o[this.start]=this}function r(n){if(!(n in this))throw new TypeError(t.format("A "+e+" Tag requires an {0}",u[n]))}var s="emit end start".split(" "),u={emit:"emit function",end:"end tag definition",start:"start tag definition"},o={};this.all=function(){return t.copy(o)},this.compileRegExp=function(){var t,e=[],n=[];for(t in o)e.push(i(o[t].end.substring(0,1))),n.push(i(o[t].start.substring(1)));return N=RegExp("(\\{["+n.join("")+"])\\s*(.+?)\\s*(["+e.join("")+"]\\})","gm")},this.create=function(t,e){return new n(t),e===!0||this.compileRegExp(),this},this.get=function(t){return o[t]}};var fe=[{start:"{{",end:"}}",emit:function(t,n,i,s){var u,o,c,f;if(""==i)throw new SyntaxError(e+" missing key in value declaration.");if(!ye.test(i)||(u=r(i,"|")?(i.match(ge)||he).filter(a):i.match(ge)),!u||2>=u.length)return t.wrap(t.formatstatement(n,i));if(u.shift(),f=t.formatstatement(n,u.shift()),c=le(u.shift().toLowerCase()),o=u.join(" "),!c||!o)throw new SyntaxError(e+" missing tag or statement in one liner value declaration.");return c(t,n,o,s)+t.wrap(f)+le("endif")}},{start:"{%",end:"%}",emit:function(n,r,i,s){if(""==i)throw new SyntaxError(e+" missing key in statement declaration.");var u,o,a;if(!(a=le(i.toLowerCase()))){if(u=i.split(" "),a=le(u.shift().toLowerCase()),0==u.length&&"string"==typeof a)return a;if(o=u.join(" "),!a||!o)throw u=[],a||u.push("tag"),o||u.push("statement"),new SyntaxError(e+" missing "+u.join(" and ")+" in statement declaration.")}if(!a)throw new SyntaxError(t.format(e+" tag: {0} does not exist.",a));return"function"==typeof a?a(n,r,o,s):a}},{start:"{[",end:"]}",emit:function(t,e,n,r){n=n.replace(pe,"$1").split("for each");var i,s,u,o,c=t.clean(n.shift()),f=t.clean(n.pop()).match(de);return n=[],f.shift(),o=f.shift(),u=f.shift(),f.length>=2&&(s=f.shift(),i=f.shift()),n.push(le("for")(t,e,(a(o)?o.match(me,"$1").join(",")+" in ":"")+u,r)),!i||n.push(le(s||"if")(t,e,i,r)),n.push(t.wrap(c.split(" ").map(function(n){return t.formatstatement(e,n)}).join(" "))),!i||n.push(le("endif")),n.push(le("endfor")(t,e)),n.join("")}},{start:"{:",end:":}",emit:function(t,e,n){return t.formatstatement(e,n)+";"}},{start:"{#",end:"#}",emit:function(t,e,n){return["\n/*",n,"*/\n"].join(" ")}}],he=[],le=E.Statement.get,pe=/\s*(,)\s*/g,de=/^\(\s*(.*?)(?:\bin\b){0,1}(.*?)\s*\)\s*(if|unless){0,1}\s*(.*)$/i,me=/(\w+)/g,ge=/^(.*?)\s+(if|unless)\s+(.*)|$/i,ye=/\s+(if|unless)\s+/i;fe.forEach(function(t){E.Tag.create(t,!0)}),E.Tag.compileRegExp(),function(){function e(t,e,n){return n.split(" ").map(function(n){return e(t,n)}).join(" ")}var n={"for":function(e,n,s){var u,o,a="U",c=a,f=e.clean(s).match(r),h=a,l=[];return null===f?u=s:(f.shift(),c=f.pop()||a,h=f.pop()||a,u=f.pop()||f.pop(),o=(f.pop()||"").match(i)),u=e.formatstatement(n,u),l.push(t.format(["","iter = new Iter( {0}, iter, {1}, {2} );","while ( iter.hasNext() ) {","$_ = iter.current;"].join("\n\r"),u,h,c)),o&&o.length>0&&(n.currentIterKeys.unshift(o),2>o.length?l.push(t.format("var {0} = iter.current;\n\r",o[0])):o.length>=2&&l.push(t.format("var {0} = iter.key, {1} = iter.current;\n\r",o[0],o[1]))),l.join("")},forempty:"\n\r}\n\rif ( iter.empty ) {\n\r",endfor:function(e,n){return n.currentIterKeys.shift(),t.format(["\n\r}","iter = iter.parent  || new Iter( null );","$_   = iter.current || $C.current(); \n\r"].join("\n\r"),e.fnvar.util)},"if":function(n,r,i){return t.format("if ( {0} ) { ",e(r,n.formatstatement,i))},elseif:function(n,r,i){return t.format(" } else if ( {0} ) { ",e(r,n.formatstatement,i))},"else":" } else { ",endif:" }",sub:function(e,n,r,i){var s,u,o,a="endsub",c=r.trim();return s=i.indexOf([a,c].join(" ")),s>-1||(s=i.indexOf(a)),u=i.splice(0,s+1),u.splice(u.length-2,u.length),c=t.format("{0}.{1}",n.id,c),o=new E("",t.copy({debug:n.debug,fallback:n.fallback,id:c},n.filters)),o.currentIterKeys=[],o.__tpl__=u.join(""),o._parse=e.compiletpl(o,e.assembleparts(o,u)),delete o.currentIterKeys,o.compiled=!0,""},unless:function(n,r,i){return t.format("if ( !( {0} ) ) { ",e(r,n.formatstatement,i))}},r=/^(\[[^,]+,\s*[^\]]+\]|[^\s]+)(?:\s+in\s+([^\s\[]+)){0,1}\s*(?:\[?(\d+)\.+(\d*)]*\]?){0,1}/i,i=/(\w+)/g;E.Statement.add(n),E.Statement.add("elsif",n.elseif)}(),E.Filter.add({capitalize:function(t){return t=E.stringify(t),t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},count:function(e){return t.len(e)||0},crop:function(t,e){return t=E.stringify(t),e=parseInt(e,10)||50,t.length>e?t.substring(0,e/2)+"..."+t.substring(t.length-e/2):t},def:function(t,e){return K.blank(t)?e:t},first:function(e){switch(t.ntype(e)){case"array":return e[0];case"string":return e.charAt(0)}},join:function(e,n){return t.got(e,"join")&&"function"==typeof e.join?e.join(n):e},last:function(e){switch(t.ntype(e)){case"array":return e[e.length-1];case"string":return e.charAt(e.length-1)}},lowercase:function(t){return E.stringify(t).toLowerCase()},prefix:function(t,e){return e+t},suffix:function(t,e){return t+e},truncate:function(t,e){return t=E.stringify(t),e=parseInt(e,10)||50,t.length>e?t.substring(0,e)+"...":t},uppercase:function(t){return E.stringify(t).toUpperCase()},wrap:function(t,e,n){return e+t+(n||e)}}),t.iter(n)||(n="commonjs"==t.ENV?module:t.global),E=t.expose(E,e,n),t.expose(t,E)}("undefined"!=typeof m8?m8:"undefined"!=typeof require?require("m8"):null,"Templ8");