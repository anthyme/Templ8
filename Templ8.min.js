!function(a){function J(b,c){return a.nativeType(b.indexOf)=="function"?!!~b.indexOf(c):c in b}function K(a){return String(a).replace(l,m)}function L(a){return N(a,Array.coerce(arguments,1))}function M(a){return F[a]||null}function N(a,b,c){return String(a).replace(c||d,function(a,c){return b[c]||""})}function O(a){return typeof a=="function"}function P(b){return a.nativeType(b)=="object"}function Q(a){return typeof a=="string"}function R(a,b,c){return c||(c=a),a.reduce(function(d,f,g){var h=b.call(c,f,g,a);return e.blank(h)||d.push(h),d},[])}function S(b){return!a.empty(b)}function T(c,d){this[h]={},this[i]=[a.global],d!==b&&(this.hasFallback=!0,this.fallback=d),e.exists(c)&&this.push(c)}function U(c,d,f,g){if(!c)return this;f=f===b?-1:f-2,g=g===b?0:g,this.index=f,this.index1=f+1,this.items=e.iterable(c)?c:null,this.type=a.nativeType(c),this.type=="object"&&(this.items=Object.values(c),this.keys=Object.keys(c),this.firstKey=this.keys[0],this.lastKey=this.keys[this.keys.length-1]),this.items&&(this.count=g?g:this.items.length,this.first=this.items[0],this.last=this.items[this.count-1]),d.items!=b&&(this.parent=d)}function V(b){this.__data=a.nativeType(b)=="array"?b:[]}function W(a,b){return!S(b)||a.push(b),a}function X(a,b){return b.reduce(function(b,c,d,e){if(d==0)return bh(a,c);var f="",g,h=c.indexOf(":");return~h?(g=c.substring(0,h),f=c.substring(h+1)):g=c,!f||(f=", "+f.split(",").map(function(a){return bh(this,a)},a).join(", ")),L(H,bc(g),g,bh(a,b),f,n.dict)},"")}function Y(a,b){var c=[p],d;while(d=b.shift())c.push(ba(a,d,b));return c.push(o),c.join("\r\n")}function Z(a){return a.replace(t,"").replace(v,"\n").replace(B," ").trim()}function $(b,c){b.debug&&typeof console!="undefined"&&(console.info("Templ8: ",b.id,", source: "),console.log(c));var d=new Function("root",n.filter,n.assert,n.util,n.dict,c);return d.bind(b,a.global,a.copy(b.filters,bj.Filter.all(),!0),e,g)}function _(a){a.currentIterKeys=[];var b=$(a,Y(a,bd(a.__tpl__)));return delete a.currentIterKeys,b}function ba(a,b,c){var d;return(d=bj.Tag.get(b))?(b=c.shift(),d.emit(r,a,b,c)):bi(L('"{0}"',b.replace(s,"\\$1")))}function bb(a,b){b=Z(b);switch(b){case"AND":return" && ";case"OR":return" || "}return J(b,"|")||J(b,k)?(" "+b+k).replace(A,function(b){return e.blank(b)||b==k?"":X(a,Z(b).split("|"))}):bh(a,b)}function bc(a){return e[a]?n.assert:g[a]?n.util:n.filter}function bd(a){return a.replace(C,E).split(D).reduce(W,[])}function be(b,c){switch(a.type(b)){case"boolean":case"number":case"string":return String(b);case"date":return b.toDateString();case"array":return R(b,be).join(", ");case"nullobject":case"object":return h in b?be(b.dict):(c=b.toString())!="[object Object]"?c:R(Object.values(b),be).join(", ");case"htmlelement":return b.textContent||b.text||b.innerText;case"htmlcollection":return R(Array.coerce(b),function(a){return be(a)}).join(", ")}return""}function bf(a){return this==a||e.startsWith(this,a+".")}function bg(a,b){return a.length?a.some(function(a){return a.some(bf,b)}):0}function bh(a,b){var d=a.currentIterKeys||[];return b=Z(b),J(b,".call(")||x.test(b)||e.startsWith(b,'"')&&e.endsWith(b,'"')||e.startsWith(b,"'")&&e.endsWith(b,"'")||!isNaN(b)?b:e.startsWith(b,"$_.")||e.startsWith(b,"iter.")||d.length&&bg(d,b)||b in c?b.replace(y,z):L('$C.get( "{0}" )',b)}function bi(a){return L("{0}.push( {1} );",n.output,a.replace(/[\n\r]/gm,"\\n"))}function bj(){var a=Array.coerce(arguments),b=P(a[a.length-1])?a.pop():P(a[0])?a.shift():null;if(!(this instanceof bj))return P(b)?new bj(a.join(""),b):new bj(a.join(""));!b||j.forEach(function(a){a in b&&(this[a]=b[a],delete b[a])},this),this.filters=b||{},this.__tpl__=a.join(""),F[bk(this)]=this,this.compiled&&(this.compiled=!1,bl(this))}function bk(a){return a.id||(a.id=L(G,++q)),a.id}function bl(a){return a.compiled||(a.compiled=!0,a._parse=_(a)),a}function bm(a){this.compiled||bl(this),this.__dict__=a;var b=this._parse(a);return delete this.__dict__,b}function bn(b){function d(a,b,d){!d&&a in c||(c[a]=b)}function e(a,b){switch(typeof b){case"string":d(b,arguments[2],a);break;case"object":for(var c in b)d(c,b[c],a)}return this}var c={};!P(b)||a.copy(c,b),this.all=function(){return a.copy(c)},this.add=function(){return e.call(this,!1,arguments[0],arguments[1])},this.get=function(a){return c[a]},this.replace=function(){return e.call(this,!0,arguments[0],arguments[1])}}"use strict";var b,c="__ASSERT__ __CONTEXT__ __FILTER_ __OUTPUT__ __UTIL__ $_ document false global instanceof null true typeof undefined window".split(" ").reduce(function(a,b){return a[b]=!0,a},a.obj()),d=/\$?\{([^\}\s]+)\}/g,e={blank:function(b){return a.empty(b)||Q(b)&&!b.trim()||!w.test(b)},contains:J,endsWith:function(a,b){a=String(a);var c=a.length-b.length;return c>=0&&a.lastIndexOf(b)==c},empty:a.empty,equals:function(a,b){return a==b},exists:a.exists,is:function(a,b){return a===b},isEven:function(a){return!(parseInt(a,10)&1)},isOdd:function(a){return!(parseInt(a,10)&1)},isTPL:function(a){return!!M(L(I,this.id,a))||!!M(a)},iterable:function(b){return u.test(a.type(b))},notEmpty:S,startsWith:function(a,b){return String(a).indexOf(b)===0}},f={},g={context:function(a,b){return new T(a,b)},output:function(a){return new V(a)},iter:function(a,b,c,d){return new U(a,b,c,d)},objectify:function(a,b){var c={};return c[b]=a,c},parse:function(b,c,d){c=String(c).trim();var e=M(L(I,this.id,c))||M(c);if(P(b)&&d!==this.__dict__){switch(a.type(d)){case"object":case"nullobject":break;case!1:d={};break;default:d={__MIXINS__:d}}b=a.copy(d,b,!0)}return e?e.parse(b):this.fallback},stop:function(a){a.stop()},type:function(b){return a.type(b)}},h="__tpl_cs_cached_keys",i="__tpl_cs_stack",j=["compiled","debug","fallback","id"],k="<~>",l=/([-\*\+\?\.\|\^\$\/\\\(\)[\]\{\}])/g,m="\\$1",n={assert:"__ASSERT__",dict:"__CONTEXT__",filter:"__FILTER__",output:"__OUTPUT__",util:"__UTIL__"},o=L('$C.destroy(); return {0}.join( "" );\n ',n.output),p=L("var $C = {0}.context( {1}, this.fallback ), $_ = $C.current(), iter = {0}.iter(), {2} = {0}.output(), U;",n.util,n.dict,n.output),q=999,r,s=/(['"])/g,t=new RegExp(k,"gm"),u=/array|htmlcollection|object|arguments|nodelist/,v=/[\r\n]+/g,w=/\S/,x=/[\(\)\[\]\{\}\?\*\+\/<>%&=!-]/,y=/\.(\d+)(\.?)/g,z="['$1']$2",A=new RegExp("\\s*([^\\|]+(?:\\|[^\\|]+?)){0,}"+k,"g"),B=/\s+/g,C,D="<__SPLIT__TEMPLATE__HERE__>",E=["","$1","$2",""].join(D),F={},G="t8-anon-{0}",H='{0}["{1}"].call( this, {2}{3}, {4} )',I="{0}.{1}";T.prototype={current:function(){return(this[i][0]||{}).dict},destroy:function(){return this.destroyed=!0,delete this[h],delete this[i],this},get:function(a){var c=this[h],d=-1,e,f,g=this[i],j=g.length,k;while(++d<j){f=g[d],e=f.dict;if(a in c&&e===c[a].o)return c[a].v;if((k=Object.value(e,a))!==b)return c[a]={o:e,v:k},f[h].push(a),c[a].v}return this.hasFallback?this.fallback:b},pop:function(){return this[i].shift()},push:function(a){var b={dict:a};return b[h]=[],this[i].unshift(b),this}},U.prototype={hasNext:function(){return this.stopped||isNaN(this.index)||!this.items||++this.index>=this.count?!1:(this.index>=this.count-1&&(this.isLast=!0),this.current=this.items[this.index],this.previous=this.items[this.index-1]||b,this.next=this.items[++this.index1]||b,this.type=="object"&&(this.key=this.keys[this.index],this.previousKey=this.keys[this.index-1]||b,this.nextKey=this.keys[this.index1]||b),this)},stop:function(){return this.stopped=!0,this}},V.prototype={join:function(){return this.__data.join("")},push:function(a){return this.__data.push(be(a)),this}},r={assembleparts:Y,clean:Z,compiletpl:$,createtpl:_,emittag:ba,fnvar:n,formatstatement:bb,get:bh,util:g,wrap:bi},bj.prototype={compiled:!1,debug:!1,fallback:"",parse:bm},a.defs(bj,{escapeRE:K,format:L,get:M,gsub:N,stringify:be},"r"),bj.Assert=new bn(e),bj.Filter=new bn(f),bj.Statement=new bn,bj.Tag=new function(){function e(c){b.forEach(f,c),a.copy(this,c),d[this.start]=this}function f(a){if(!(a in this))throw new TypeError(L("A Templ8 Tag requires an {0}",c[a]))}var b="emit end start".split(" "),c={emit:"emit function",end:"end tag definition",start:"start tag definition"},d={};this.all=function(){return a.copy(d)},this.compileRegExp=function(){var a=[],b=[],c;for(c in d)a.push(K(d[c].end.substring(0,1))),b.push(K(d[c].start.substring(1)));return C=new RegExp("(\\{["+b.join("")+"])\\s*(.+?)\\s*(["+a.join("")+"]\\})","gm")},this.create=function(a,b){return new e(a),b===!0||this.compileRegExp(),this},this.get=function(a){return d[a]}};var bo=[{start:"{{",end:"}}",emit:function(a,b,c,d){var e,f,g,h;if(c=="")throw new SyntaxError("Templ8 missing key in value declaration.");!bv.test(c)||(e=J(c,"|")?(c.match(bu)||bp).filter(S):c.match(bu));if(!e||e.length<=2)return a.wrap(a.formatstatement(b,c));e.shift(),h=a.formatstatement(b,e.shift()),g=bq(e.shift().toLowerCase()),f=e.join(" ");if(!g||!f)throw new SyntaxError("Templ8 missing tag or statement in one liner value declaration.");return g(a,b,f,d)+a.wrap(h)+bq("endif")}},{start:"{%",end:"%}",emit:function(a,b,c,d){if(c=="")throw new SyntaxError("Templ8 missing key in statement declaration.");var e,f,g;if(!(g=bq(c.toLowerCase()))){e=c.split(" "),g=bq(e.shift().toLowerCase());if(e.length==0&&Q(g))return g;f=e.join(" ");if(!g||!f)throw new SyntaxError("Templ8 missing tag or statement in statement declaration.")}if(!g)throw new SyntaxError(L("Templ8 tag: {0} does not exist.",g));return O(g)?g(a,b,f,d):g}},{start:"{[",end:"]}",emit:function(a,b,c,d){c=c.replace(br,"$1").split("for each");var e,f,g,h,i=a.clean(c.shift()),j=a.clean(c.pop()).match(bs);return c=[],j.shift(),h=j.shift(),g=j.shift(),j.length>=2&&(f=j.shift(),e=j.shift()),c.push(bq("for")(a,b,(S(h)?h.match(bt,"$1").join(",")+" in ":"")+g,d)),!e||c.push(bq(f||"if")(a,b,e,d)),c.push(a.wrap(i.split(" ").map(function(c){return a.formatstatement(b,c)}).join(" "))),!e||c.push(bq("endif")),c.push(bq("endfor")(a,b)),c.join("")}},{start:"{:",end:":}",emit:function(a,b,c){return a.formatstatement(b,c)+";"}},{start:"{#",end:"#}",emit:function(a,b,c){return["\n/*",c,"*/\n"].join(" ")}}],bp=[],bq=bj.Statement.get,br=/\s*(,)\s*/g,bs=/^\(\s*(.*?)(?:\bin\b){0,1}(.*?)\s*\)\s*(if|unless){0,1}\s*(.*)$/i,bt=/(\w+)/g,bu=/^(.*?)\s+(if|unless)\s+(.*)|$/i,bv=/\s+(if|unless)\s+/i;bo.forEach(function(a){bj.Tag.create(a,!0)}),bj.Tag.compileRegExp(),function(){function f(a,b,c){return c.split(" ").map(function(c){return b(a,c)}).join(" ")}var c={"for":function(a,c,f){var g,h,i,j=a.clean(f).match(d),k,l=[],m="U",n=a.fnvar;return j===null?h=f:(j.shift(),g=j.pop()||b,k=j.pop()||b,h=j.pop()||j.pop(),i=(j.pop()||"").match(e)),h=a.formatstatement(c,h),l.push(L(["\n\rif ( {0}.iterable( {1} ) ) iter = {2}.iter( {1}, iter, {3}, {4} );","while ( iter.hasNext() ) {","$_ = iter.current;","$C.push( iter.current );\n\r"].join("\n\r"),n.assert,h,n.util,k||m,g||m)),i&&i.length>0&&(c.currentIterKeys.unshift(i),i.length<2?l.push(L("var {0} = iter.current;\n\r",i[0])):i.length>=2&&l.push(L("var {0} = iter.key || iter.index, {1} = iter.current;\n\r",i[0],i[1]))),l.join("")},forempty:"\n\r}\n\rif ( iter.count <= 0 || !iter.items )\n\r{\n\r",endfor:function(a,b){return b.currentIterKeys.shift(),L(["\n\r$C.pop();","}","if ( $C.current() === iter.current ) { $C.pop(); }","iter = iter.parent || {0}.iter();","$_ = iter.current || $C.current();\n\r"].join("\n\r"),a.fnvar.util)},"if":function(a,b,c){return L("if ( {0} ) { ",f(b,a.formatstatement,c))},elseif:function(a,b,c){return L(" } else if ( {0} ) { ",f(b,a.formatstatement,c))},"else":" } else { ",endif:" }",sub:function(b,c,d,e){var f="endsub",g,h=d.trim(),i,j;return g=e.indexOf([f,h].join(" ")),g>-1||(g=e.indexOf(f)),i=e.splice(0,g+1),i.splice(i.length-2,i.length),h=L("{0}.{1}",c.id,h),j=new bj("",a.copy({debug:c.debug,fallback:c.fallback,id:h},c.filters)),j.currentIterKeys=[],j.__tpl__=i.join(""),j._parse=b.compiletpl(j,b.assembleparts(j,i)),delete j.currentIterKeys,j.compiled=!0,""},unless:function(a,b,c){return L("if ( !( {0} ) ) { ",f(b,a.formatstatement,c))}},d=/^(\[[^,]+,\s*[^\]]+\]|[^\s]+)(?:\s+in\s+([^\s\[]+)){0,1}\s*(?:\[?(\d+)\.+(\d*)]*\]?){0,1}/i,e=/(\w+)/g;bj.Statement.add(c),bj.Statement.add("elsif",c.elseif)}(),bj.Filter.add({capitalize:function(a){return a=bj.stringify(a),a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},count:function(b){return a.len(b)||0},crop:function(a,b){return a=bj.stringify(a),b=parseInt(b,10)||50,a.length>b?a.substring(0,b/2)+"..."+a.substring(a.length-b/2):a},def:function(a,b){return e.blank(a)?b:a},first:function(b){switch(a.nativeType(b)){case"array":return b[0];case"string":return b.charAt(0)}},join:function(b,c){return a.got(b,"join")&&typeof b.join=="function"?b.join(c):b},last:function(b){switch(a.nativeType(b)){case"array":return b[b.length-1];case"string":return b.charAt(b.length-1)}},lowercase:function(a){return bj.stringify(a).toLowerCase()},prefix:function(a,b){return b+a},suffix:function(a,b){return a+b},truncate:function(a,b){return a=bj.stringify(a),b=parseInt(b,10)||50,a.length>b?a.substring(0,b)+"...":a},uppercase:function(a){return bj.stringify(a).toUpperCase()},wrap:function(a,b,c){return b+a+(c||b)}}),a.def(bj,"m8",a.describe({value:a},"r")),a.ENV!="commonjs"?a.def(a.global,"Templ8",a.describe({value:bj},"r")):module.exports=bj}(typeof m8!="undefined"?m8:typeof require!="undefined"?require("m8"):null)