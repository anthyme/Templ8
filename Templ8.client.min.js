(function(a){function bE(a){function c(c,d,e){if(e||!(c in b))b[c]=d;a=b}var b={};be(a)&&_(b,a),this.all=function(){return _(b)},this.add=function(a){switch(typeof a){case h:c(a,arguments[1],i);break;case g:for(var b in a)c(b,a[b],i)}return this},this.get=function(a){return b[a]},this.replace=function(a){switch(typeof a){case h:c(a,arguments[1],k);break;case g:for(var b in a)c(b,a[b],k)}return this}}function bD(a){this.compiled||bC(this);return this._parse(a)}function bC(a){a.compiled||(a.compiled=k,a._parse=bq(a,a.__tpl));return a}function bB(a){a.id||(a.id=bb(V,++A));return a.id}function bA(){var a=o.call(arguments),b=be(a[a.length-1])?a.pop():be(a[0])?a.shift():null;if(this instanceof bA)this.filters=b||{},!b||["compiled","debug","fallback","id"].forEach(function(a){if(a in b)this[a]=b[a],delete b[a];else return},this),this.__tpl=a.join(""),U[bB(this)]=this,this.compiled&&(this.compiled=i,bC(this));else return be(b)?new bA(a.join(""),b):new bA(a.join(""))}function bz(a){return bb("{0}.push( {1} );",x.output,a.replace(/[\n\r]/gm,"\\n"))}function by(a,b){b=bo(b);var c=a.currentIterKeys||[];return $(b,".call(")||M.test(b)||p.startsWith(b,'"')&&p.endsWith(b,'"')||p.startsWith(b,"'")&&p.endsWith(b,"'")||!isNaN(b)?b:p.startsWith(b,"$_.")||p.startsWith(b,"iter.")||c.length&&bx(c,b)||b in m?b.replace(N,O):bb('$C.get( "{0}" )',b)}function bx(a,b){return a.length?a.some(function(a){return a.some(bw,b)}):0}function bw(a){return this==a||p.startsWith(this,a+".")}function bv(a){switch(bA.type(a)){case h:case f:case"boolean":return String(a);case"date":return a.toDateString();case b:return bf(a,bv).join(", ");case g:if(s in a)return bv(a.dict);var c=a.toString();if(c!="[object Object]")return c;return bf(D(a),bv).join(", ");case e:return a.textContent;case d:return bf(o.call(a),function(a){return a.textContent}).join(", ")}return""}function bu(a){var b=a.replace(R,T);b=b.split(S),b=b.reduce(bl,[]);return b}function bt(a){return p[a]?x.assert:r[a]?x.util:x.filter}function bs(a,b){b=bo(b);return $(b,"|")||$(b,u)?(" "+b+u).replace(P,function(b){if(p.blank(b)||b==u)return"";var c=bo(b).split("|");return bm(a,c)}):by(a,b)}function br(a,b,c){var d;if(d=bA.Tag.get(b)){b=c.shift();return d.emit(B,a,b,c)}return bz(bb('"{0}"',b.replace(F,"\\$1")))}function bq(a,b){a.currentIterKeys=[];var c=bp(a,bn(a,bu(b)));delete a.currentIterKeys;return c}function bp(b,c){b.debug&&a.console&&(console.info(b.id),console.log(c));var d=new Function(x.filter,x.assert,x.util,x.dict,c);return Z(d,b,_(b.filters,bA.Filter.all(),k),p,r)}function bo(a){return a.replace(H,"").replace(J,"\n").replace(Q," ").trim()}function bn(a,b){var c=[z],d;while(d=b.shift())c.push(br(a,d,b));c.push(y);return c.join("\r\n")}function bm(a,b){return b.reduce(function(b,c,d,e){if(d==0)return by(a,c);c=c.split(":");var f="",g=c.shift();typeof c[0]==h&&(f=", "+c[0].split(",").map(function(a){return by(this,a)},a).join(", "));return bb(W,bt(g),g,by(a,b),f,x.dict)},"")}function bl(a,b){!bg(b)||a.push(b);return a}function bk(a){this.__data=bA.type(a)==b?a:[]}function bj(a,b,c,d){if(!a)return this;c=c===l?-1:c-2,d=d===l?0:d,this.index=c,this.index1=c+1,this.items=p.iterable(a)?a:j,this.type=bA.type(a),this.type==g&&(this.items=D(a),this.keys=C(a),this.firstKey=this.keys[0],this.lastKey=this.keys[this.keys.length-1]),this.items&&(this.count=d?d:this.items.length,this.first=this.items[0],this.last=this.items[this.count-1]),b.items!=l&&(this.parent=b)}function bi(b,c){this[s]={},this[t]=[a],c!==l&&(this.hasFallback=k,this.fallback=c),p.exists(b)&&this.push(b)}function bh(a){if(a===l)return l;var b=o.call(arguments,1),c;if(b.length==1){if(b[0]===l)return l;if(b[0].indexOf(".")<0)return a[b[0]];b=b[0].split(".")}while(c=b.shift())if(c in a)a=a[c];else return l;return a}function bg(a){switch(bA.type(a)){case i:return i;case f:return!isNaN(a);case h:return a!="";case b:return!!a.length;case g:for(var c in a)if(c)return k}return i}function bf(a,b,c){c||(c=a);return a.reduce(function(d,e,f){var g=b.call(c,e,f,a);p.blank(g)||d.push(g);return d},[])}function be(a){return bA.type(a)==g}function bd(a,b,c){return String(a).replace(c||n,function(a,c){return b[c]||""})}function bc(a){return U[a]||j}function bb(a){return bd(a,o.call(arguments,1))}function ba(a){return String(a).replace(v,w)}function _(a,b,c){c=c===k,b||(b=a,a={});for(var d in b)if(!c||!(d in a))a[d]=b[d];return a}function $(a,b){return bA.type(a.indexOf)==c?a.indexOf(b)>-1:b in a}function Z(a,b){var c=o.call(arguments,2);return function(){return a.apply(b||this,c.concat(o.call(arguments)))}}function Y(a){if(a===l||a===j)return i;var b={}.toString.call(a).substring(8).toLowerCase().replace(L,"");return E.test(b)?d:G.test(b)?e:b}var b="array",c="function",d="htmlcollection",e="htmlelement",f="number",g="object",h="string",i=!1,j=null,k=!0,l,m={$_:k,__ASSERT__:k,__CONTEXT__:k,__FILTER_:k,__OUTPUT__:k,__UTIL__:k,document:k,"false":k,"instanceof":k,"null":k,"true":k,"typeof":k,"undefined":k,window:k},n=/\{([^\}\s]+)\}/g,o=[].slice,p={blank:function(a){return!bg(a)||a.trim()==""||!K.test(a)},contains:$,endsWith:function(a,b){a=String(a);var c=a.length-b.length;return c>=0&&a.lastIndexOf(b)==c},empty:function(a){return!bg(a)},equals:function(a,b){return a==b},exists:function(a){return typeof a==f?!isNaN(a):a!==l&&a!==j},is:function(a,b){return a===b},isEven:function(a){return!(parseInt(a,10)&1)},isOdd:function(a){return!(parseInt(a,10)&1)},isTPL:function(a){return!!bc(bb(X,this.id,a))||!!bc(a)},iterable:function(a){return I.test(bA.type(a))},notEmpty:bg,startsWith:function(a,b){return String(a).indexOf(b)===0},type:Y},q={},r={context:function(a,b){return new bi(a,b)},output:function(a){return new bk(a)},iter:function(a,b,c,d){return new bj(a,b,c,d)},parse:function(a,b){b=String(b).trim();var c=bc(bb(X,this.id,b))||bc(b);return c?c.parse(a,this.filters):this.fallback},stop:function(a){a.stop()}},s="__tpl_cs_cached_keys",t="__tpl_cs_stack",u="<~>",v=/([\u0021\u0028\u0029\u002a\u002b\u002e\u003a\u003d\u003f\u005b\u005d\u005e\u007b\u007c\u007d\/\\])/g,w="\\$1",x={assert:"__ASSERT__",dict:"__CONTEXT__",filter:"__FILTER__",output:"__OUTPUT__",util:"__UTIL__"},y=bb('$C.destroy(); return {0}.join( "" );\n ',x.output),z=bb("var $C = {0}.context( {1}, this.fallback ), $_ = $C.current(), iter = {0}.iter(), {2} = {0}.output(), UNDEF;",x.util,x.dict,x.output),A=999,B,C=Object.keys||function(a){var b,c=[];for(b in a)c.push(b);return c},D=Object.values||function(a){var b,c=[];for(b in a)c.push(a[b]);return c},E=/htmcollection|nodelist/,F=/(['"])/g,G=/^html\w+?element$/,H=new RegExp(u,"gm"),I=/array|htmlcollection|object|arguments|nodelist/,J=/[\r\n]+/g,K=/\S/,L=/\]$/,M=/[\(\)\[\]\{\}\?\*\+\/<>%&=!-]/,N=/\.(\d+)(\.?)/g,O="['$1']$2",P=new RegExp("\\s*([^\\|]+(?:\\|[^\\|]+?)){0,}"+u,"g"),Q=/\s+/g,R,S="<__SPLIT__TEMPLATE__HERE__>",T=["","$1","$2",""].join(S),U={},V="tpl-anon-{0}",W='{0}["{1}"].call( this, {2}{3}, {4} )',X="{0}.{1}";bi.prototype={current:function(){return this[t][0].dict},destroy:function(){this.destroyed=k,delete this[s],delete this[t];return this},get:function(a){var b=this[s],c=-1,d,e,f=this[t],g=f.length,h;while(++c<g){e=f[c],d=e.dict;if(a in b&&d===b[a].o)return b[a].v;if((h=bh(d,a))!==l){b[a]={o:d,v:h},e[s].push(a);return b[a].v}}return this.hasFallback?this.fallback:l},pop:function(){return this[t].shift()},push:function(a){var b={dict:a};b[s]=[],this[t].unshift(b);return this}},bj.prototype={hasNext:function(){if(this.stopped||isNaN(this.index)||!this.items)return i;if(++this.index>=this.count)return i;this.index>=this.count-1&&(this.isLast=k),this.current=this.items[this.index],this.previous=this.items[this.index-1]||l,this.next=this.items[++this.index1]||l,this.type==g&&(this.key=this.keys[this.index],this.previousKey=this.keys[this.index-1]||l,this.nextKey=this.keys[this.index1]||l);return this},stop:function(){this.stopped=k;return this}},bk.prototype={join:function(){return this.__data.join("")},push:function(a){this.__data.push(bv(a));return this}},B={assembleparts:bn,clean:bo,compiletpl:bp,createtpl:bq,emittag:br,fnvar:x,formatstatement:bs,get:by,util:r,wrap:bz},bA.prototype={compiled:i,debug:i,fallback:"",parse:bD},_(bA,{copy:_,escapeRE:ba,fnBind:Z,format:bb,get:bc,gsub:bd,objectKeys:C,objectValues:D,tostr:bv,type:Y}),bA.Assert=new bE(p),bA.Filter=new bE(q),bA.Statement=new bE,bA.Tag=new function(){function e(a){if(!(a in this))throw new TypeError(bb("A Templ8 Tag requires an {0}",b[a]))}function d(b){a.forEach(e,b),_(this,b),c[this.start]=this}var a="emit end start".split(" "),b={emit:"emit function",end:"end tag definition",start:"start tag definition"},c={};this.all=function(){return _(c)},this.compileRegExp=function(){var a=[],b=[],d;for(d in c)a.push(ba(c[d].end.substring(0,1))),b.push(ba(c[d].start.substring(1)));return R=new RegExp("(\\{["+b.join("")+"])\\s*(.+?)\\s*(["+a.join("")+"]\\})","gm")},this.create=function(a,b){new d(a),b!==k&&this.compileRegExp();return this},this.get=function(a){return c[a]}};var bF=[{start:"{{",end:"}}",emit:function(a,b,c,d){if(c=="")throw new SyntaxError("Templ8 missing key in value declaration.");var e,f,g,h;bM.test(c)&&(e=$(c,"|")?(c.match(bL)||bG).filter(bg):c.match(bL));if(!e||e.length<=2)return a.wrap(a.formatstatement(b,c));e.shift(),h=a.formatstatement(b,e.shift()),g=bH(e.shift().toLowerCase()),f=e.join(" ");if(!g||!f)throw new SyntaxError("Templ8 missing tag or statement in one liner value declaration.");return g(a,b,f,d)+a.wrap(h)+bH("endif")}},{start:"{%",end:"%}",emit:function(a,b,d,e){if(d=="")throw new SyntaxError("Templ8 missing key in statement declaration.");var f,g,i;if(!(i=bH(d.toLowerCase()))){f=d.split(" "),i=bH(f.shift().toLowerCase());if(f.length==0&&typeof i==h)return i;g=f.join(" ");if(!i||!g)throw new SyntaxError("Templ8 missing tag or statement in statement declaration.")}if(!i)throw new SyntaxError(bb("Templ8 tag: {0} does not exist.",i));return typeof i==c?i(a,b,g,e):i}},{start:"{[",end:"]}",emit:function(a,b,c,d){c=c.replace(bI,"$1").split("for each");var e,f,g,h,i=a.clean(c.shift()),j=a.clean(c.pop()).match(bJ);c=[],j.shift(),h=j.shift(),g=j.shift(),j.length>=2&&(f=j.shift(),e=j.shift()),c.push(bH("for")(a,b,(bg(h)?h.match(bK,"$1").join(",")+" in ":"")+g,d)),e&&c.push(bH(f||"if")(a,b,e,d)),c.push(a.wrap(i.split(" ").map(function(c){return a.formatstatement(b,c)}).join(" "))),e&&c.push(bH("endif")),c.push(bH("endfor")(a,b));return c.join("")}},{start:"{:",end:":}",emit:function(a,b,c){return a.formatstatement(b,c)+";"}},{start:"{#",end:"#}",emit:function(a,b,c){return["\n/*",c,"*/\n"].join(" ")}}],bG=[],bH=bA.Statement.get,bI=/\s*(,)\s*/g,bJ=/^\(\s*(.*?)(?:\bin\b){0,1}(.*?)\s*\)\s*(if|unless){0,1}\s*(.*)$/i,bK=/(\w+)/g,bL=/^(.*?)\s+(if|unless)\s+(.*)|$/i,bM=/\s+(if|unless)\s+/i;bF.forEach(function(a){bA.Tag.create(a,k)}),bA.Tag.compileRegExp(),function(){function d(a,b,c){return c.split(" ").map(function(c){return b(a,c)}).join(" ")}var a={"for":function(a,d,e){var f,g,h,i=a.clean(e).match(b),k,m=[],n="UNDEF",o=a.fnvar;i===j?g=e:(i.shift(),f=i.pop()||l,k=i.pop()||l,g=i.pop()||i.pop(),h=(i.pop()||"").match(c)),g=a.formatstatement(d,g),m.push(bb(["\n\rif ( {0}.iterable( {1} ) ) iter = {2}.iter( {1}, iter, {3}, {4} );","while ( iter.hasNext() ) {","$_ = iter.current;","$C.push( iter.current );\n\r"].join("\n\r"),o.assert,g,o.util,k||n,f||n)),h&&h.length>0&&(d.currentIterKeys.unshift(h),h.length<2?m.push(bb("var {0} = iter.current;\n\r",h[0])):h.length>=2&&m.push(bb("var {0} = iter.key || iter.index, {1} = iter.current;\n\r",h[0],h[1])));return m.join("")},forempty:"\n\r}\n\rif ( iter.count <= 0 || !iter.items )\n\r{\n\r",endfor:function(a,b){b.currentIterKeys.shift();return bb(["\n\r$C.pop();","}","if ( $C.current() === iter.current ) { $C.pop(); }","iter = iter.parent || {0}.iter();","$_ = iter.current || $C.current();\n\r"].join("\n\r"),a.fnvar.util)},"if":function(a,b,c){return bb("if ( {0} ) { ",d(b,a.formatstatement,c))},elseif:function(a,b,c){return bb(" } else if ( {0} ) { ",d(b,a.formatstatement,c))},"else":" } else { ",endif:" }",sub:function(a,b,c,d){var e="endsub",f,g=c.trim(),h,i;f=d.indexOf([e,g].join(" ")),f>-1||(f=d.indexOf(e)),h=d.splice(0,f+1),h.splice(h.length-2,h.length),g=bb("{0}.{1}",b.id,g),i=new bA("",bA.copy({debug:b.debug,fallback:b.fallback,id:g},b.filters)),i.currentIterKeys=[],i.__tpl=h.join(""),i._parse=a.compiletpl(i,a.assembleparts(i,h)),delete i.currentIterKeys,i.compiled=k;return""},unless:function(a,b,c){return bb("if ( !( {0} ) ) { ",d(b,a.formatstatement,c))}},b=/^(\[[^,]+,\s*[^\]]+\]|[^\s]+)(?:\s+in\s+([^\s\[]+)){0,1}\s*(?:\[?(\d+)\.+(\d*)]*\]?){0,1}/i,c=/(\w+)/g;bA.Statement.add(a),bA.Statement.add("elsif",a.elseif)}(),bA.Filter.add({capitalize:function(a){a=bA.tostr(a);return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},count:function(a){switch(Templ8.type(a)){case"array":case"htmlcollection":case"string":return a.length;case"object":return Templ8.objectKeys(a).length}return 0},crop:function(a,b){a=bA.tostr(a),b=parseInt(b,10)||50;return a.length>b?a.substring(0,b/2)+"..."+a.substring(a.length-b/2):a},def:function(a,b){return p.blank(a)?b:a},first:function(a){switch(bA.type(a)){case b:return a[0];case h:return a.charAt(0)}},last:function(a){switch(bA.type(a)){case b:return a[a.length-1];case h:return a.charAt(a.length-1)}},lowercase:function(a){return bA.tostr(a).toLowerCase()},prefix:function(a,b){return b+a},suffix:function(a,b){return a+b},truncate:function(a,b){a=bA.tostr(a),b=parseInt(b,10)||50;return a.length>b?a.substring(0,b)+"...":a},uppercase:function(a){return bA.tostr(a).toUpperCase()}}),window.Templ8=bA})(window)